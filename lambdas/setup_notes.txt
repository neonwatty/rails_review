AWS SIDE

1.  Permission role for API Gateway

This role needs to be created - see the current version - we'll figure out how to generate from local machine

f"arn:aws:iam::{ACCOUNT_ID}:role/APIGatewayInvokeLambdaRole"


2.  Create s3 buckets and sqs 

Did this manually - not sure how to automate


3.  Permissions for SQS queue <--> S3 connection

Easiest way I know so far is to do manual.  Each s3 <--> sqs needs this policy connection

https://docs.aws.amazon.com/AmazonS3/latest/userguide/grant-destinations-permissions-to-s3.html


4.  ECR repositories for any images

Unfortunately I don't know at present a better way to build / deploy images to ECR other than the "custom" route.

For example, in our base template step_1 will simply extract audio from video and save the latter back to s3.

For this we need ffmpeg - which needs to be installed specically for lambda / arm / etc.,

https://www.johnvansickle.com/ffmpeg/

My current solution to this - download and unzip the proper ffmpeg static version and copy it into the image at build time.

Testing still will be rather cumbersom and finicky.

One thing we can do - make sure to re-build / re-deploy all lambdas prior to running tests.  

Or at least giving ourself that option conenvinently.




UP NEXT:

We need a testing pattern for Docker based lambdas.

It can start with: local testing of the python function only, mocking up required components.

Then must include: a local docker test, with properly mocked i/o.  How to do this?  I'm not sure.

Then: cloud decoupled.

Then: cloud integrated.